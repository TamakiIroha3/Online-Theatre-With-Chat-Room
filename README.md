# åœ¨çº¿æ”¾æ˜ å®¤ (Online Theater)

ä¸€ä¸ªåŸºäºPythonå¼€å‘çš„å®æ—¶è§†é¢‘æµåˆ†äº«å’ŒèŠå¤©å®¤åº”ç”¨ï¼Œæ”¯æŒSRT/RTMPåè®®çš„è§†é¢‘æµä¼ è¾“ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

-  **è§†é¢‘æµåˆ†äº«**ï¼šæ”¯æŒé€šè¿‡SRTåè®®æ¥æ”¶æœ¬åœ°æˆ–è¿œç¨‹OBSæ¨æµï¼Œå¹¶åˆ†å‘ç»™å¤šä¸ªè§‚çœ‹è€…
-  **å®æ—¶èŠå¤©å®¤**ï¼šå†…ç½®èŠå¤©å®¤åŠŸèƒ½ï¼Œæ”¯æŒemojiè¡¨æƒ…
-  **IPv6æ”¯æŒ**ï¼šä¼˜å…ˆæ”¯æŒIPv6ç½‘ç»œï¼ŒåŒæ—¶å…¼å®¹IPv4
-  **å¤šç”¨æˆ·æ”¯æŒ**ï¼šæ”¯æŒå¤šä¸ªæ¥æ”¶ç«¯åŒæ—¶è§‚çœ‹
-  **éªŒè¯ç ä¿æŠ¤**ï¼šé€šè¿‡6ä½æ•°å­—éªŒè¯ç æ§åˆ¶è®¿é—®æƒé™

## å¯æ”¯æŒçš„å®‰å…¨æ€§æ‰©å±•
-  **è§†é¢‘æµä¿æŠ¤**: RTMPæœåŠ¡ä¸æš´éœ²ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶ä¼šå•ç‹¬å¼€å¯ä¸€ä¸ªSRTç«¯å£ä¸“ä¾›æ­¤è¿æ¥ï¼Œå¹¶ä¸”SRTæœ¬èº«å¯é€‰åŠ å¯†æµ
-  **WebSocket**: å¯ä»¥ä½¿ç”¨wssæ¥æ›¿ä»£ç°æœ‰çš„wsæœåŠ¡ï¼Œä½¿ç”¨TLSåŠ å¯†è¿æ¥ä¸èŠå¤©ä¿¡æ¯

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### è¿è¡Œç¯å¢ƒ
- Python 3.8+ (å¼€å‘ä¸æµ‹è¯•ç¯å¢ƒï¼š3.13)
- Windows 10/11 (ä¸»è¦æ”¯æŒ)
- 2GB+ RAM
- ç¨³å®šçš„ç½‘ç»œè¿æ¥

### Pythonä¾èµ–
- PySide6 >= 6.5.0 (Qt GUIæ¡†æ¶)
- websockets >= 11.0 (WebSocketé€šä¿¡)
- netifaces >= 0.11.0 (ç½‘ç»œæ¥å£)
- psutil >= 5.9.5 (è¿›ç¨‹ç®¡ç†)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/your-repo/online-theater.git
cd online-theater
```

### 2. å®‰è£…Pythonä¾èµ–

```bash
pip install -r requirements.txt
```

### 3. ä¸‹è½½å¤–éƒ¨ç¨‹åº

#### FFmpeg (å¿…éœ€)
- ä¸‹è½½åœ°å€ï¼šhttps://www.gyan.dev/ffmpeg/builds/
- é€‰æ‹© "release builds" çš„ "full" ç‰ˆæœ¬
- è§£å‹åå°† `ffmpeg.exe` å¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•

#### MPVæ’­æ”¾å™¨ (å¿…éœ€)
- ä¸‹è½½åœ°å€ï¼šhttps://mpv.io/installation/
- Windows: ä¸‹è½½ Windows builds
- å°† `mpv.exe` å’Œ `mpv.com` å¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•
- å¦‚æœ‰ `d3dcompiler_43.dll` ä¹Ÿä¸€å¹¶å¤åˆ¶

#### Nginx-RTMP (å¿…éœ€)
- Windowsç‰ˆä¸‹è½½ï¼šhttps://github.com/illuspas/nginx-rtmp-win32
- è§£å‹åå°†æ•´ä¸ªnginxæ–‡ä»¶å¤¹æ”¾åˆ°é¡¹ç›®çš„ `rtmp/` ç›®å½•
- ç¡®ä¿è·¯å¾„ä¸º `./rtmp/nginx.exe`

### 4. ç›®å½•ç»“æ„éªŒè¯

ç¡®ä¿é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
```
online_theater/
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åº
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â”œâ”€â”€ ffmpeg.exe            # [éœ€ä¸‹è½½] FFmpegå¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ mpv.exe              # [éœ€ä¸‹è½½] MPVæ’­æ”¾å™¨
â”œâ”€â”€ mpv.com              # [éœ€ä¸‹è½½] MPVå‘½ä»¤è¡Œæ¥å£
â”œâ”€â”€ d3dcompiler_43.dll   # [å¯é€‰] D3Dç¼–è¯‘å™¨
â”œâ”€â”€ rtmp/
â”‚   â””â”€â”€ nginx.exe        # [éœ€ä¸‹è½½] Nginx-RTMPæœåŠ¡å™¨
â”œâ”€â”€ ui/                  # UIæ¨¡å—ç›®å½•
â”œâ”€â”€ network/             # ç½‘ç»œæ¨¡å—ç›®å½•
â”œâ”€â”€ streaming/           # æµåª’ä½“æ¨¡å—ç›®å½•
â”œâ”€â”€ utils/               # å·¥å…·æ¨¡å—ç›®å½•
â””â”€â”€ logs/                # [è‡ªåŠ¨åˆ›å»º] æ—¥å¿—ç›®å½•
```

### 5. å¯åŠ¨ç¨‹åº

#### Windowsç”¨æˆ·
åŒå‡»è¿è¡Œ `start.bat` æˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œï¼š
```bash
python main.py
```

#### Linux/macOSç”¨æˆ·
```bash
python3 main.py
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å‘é€ç«¯ï¼ˆä¸»æ’­ï¼‰æ“ä½œæµç¨‹

1. **å¯åŠ¨ç¨‹åº**ï¼Œé€‰æ‹©ã€å‘é€ç«¯ã€‘

2. **é…ç½®ç½‘ç»œå‚æ•°**ï¼š
   - **ç»‘å®šIP**ï¼šé€‰æ‹©ç½‘ç»œæ¥å£ï¼ˆæ¨èIPv6ï¼Œé»˜è®¤0.0.0.0ç›‘å¬æ‰€æœ‰ï¼‰
   - **SRTç«¯å£**ï¼šç”¨äºæ¥æ”¶OBSæ¨æµï¼ˆé»˜è®¤9001ï¼‰
   - **WebSocketç«¯å£**ï¼šç”¨äºèŠå¤©æœåŠ¡ï¼ˆé»˜è®¤10086ï¼‰
   - **æ˜µç§°**ï¼šæ‚¨çš„æ˜¾ç¤ºåç§°ï¼ˆéšæœºFateè§’è‰²åï¼‰
   - **éªŒè¯ç **ï¼š6ä½æ•°å­—ï¼Œåˆ†äº«ç»™è§‚çœ‹è€…ï¼ˆé»˜è®¤114514ï¼‰
   - **æœ¬åœ°æ’­æ”¾**ï¼šæ˜¯å¦åœ¨æœ¬åœ°ä¹Ÿæ’­æ”¾è§†é¢‘

3. **ç‚¹å‡»ã€ç¡®è®¤ã€‘**å¯åŠ¨æœåŠ¡
   - ç¨‹åºä¼šè‡ªåŠ¨å¯åŠ¨Nginx RTMPæœåŠ¡å™¨
   - FFmpegå¼€å§‹ç›‘å¬SRTç«¯å£
   - MPVæ’­æ”¾å™¨å¼€å§‹å¾ªç¯å°è¯•è¿æ¥RTMPæµ

4. **é…ç½®OBSæ¨æµ**ï¼š
   - è®¾ç½® -> æ¨æµ
   - æœåŠ¡ï¼šè‡ªå®šä¹‰
   - æœåŠ¡å™¨ï¼š`srt://127.0.0.1:9001` (æœ¬åœ°) æˆ– `srt://[æ‚¨çš„IP]:9001` (è¿œç¨‹)
   - ä¸²æµå¯†é’¥ï¼šç•™ç©º

5. **å¼€å§‹æ¨æµ**ï¼ŒMPVä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æµå¹¶å¼€å§‹æ’­æ”¾

### æ¥æ”¶ç«¯ï¼ˆè§‚ä¼—ï¼‰æ“ä½œæµç¨‹

1. **å¯åŠ¨ç¨‹åº**ï¼Œé€‰æ‹©ã€æ¥æ”¶ç«¯ã€‘

2. **è¾“å…¥è¿æ¥ä¿¡æ¯**ï¼š
   - **æœåŠ¡å™¨IP**ï¼šå‘é€ç«¯çš„IPåœ°å€ï¼ˆæ”¯æŒIPv4/IPv6ï¼‰
   - **æœåŠ¡å™¨ç«¯å£**ï¼šWebSocketç«¯å£ï¼ˆé»˜è®¤10086ï¼‰
   - **æ˜µç§°**ï¼šæ‚¨çš„æ˜¾ç¤ºåç§°
   - **éªŒè¯ç **ï¼šä»å‘é€ç«¯è·å–çš„6ä½éªŒè¯ç 

3. **ç‚¹å‡»ã€è¿æ¥ã€‘**åŠ å…¥æ”¾æ˜ å®¤
   - è‡ªåŠ¨è¿›å…¥èŠå¤©å®¤
   - 2ç§’åè‡ªåŠ¨å¯åŠ¨æ’­æ”¾å™¨

### OBSæ¨æµè®¾ç½®å»ºè®®

#### è¾“å‡ºè®¾ç½®
- **ç¼–ç å™¨**ï¼šx264 æˆ– NVENC/AMF/QuickSync H264ï¼ˆç¡¬ä»¶ç¼–ç ï¼‰ å¦‚æœä½ ç”¨çš„RTMPæ”¯æŒHEVCæ‰©å±•ä¹Ÿå¯ä»¥ä½¿ç”¨HEVC
- **é€Ÿç‡æ§åˆ¶**ï¼šCBRï¼ˆæ’å®šæ¯”ç‰¹ç‡ï¼‰
- **æ¯”ç‰¹ç‡**ï¼š3000-8000 Kbpsï¼ˆæ ¹æ®ç½‘ç»œè°ƒæ•´ï¼‰
- **å…³é”®å¸§é—´éš”**ï¼š1-2 ç§’
- **CPUä½¿ç”¨é¢„è®¾**ï¼šveryfast æˆ– faster
- **é…ç½®æ–‡ä»¶**ï¼šhigh
- **è°ƒæ•´**ï¼šzerolatencyï¼ˆé›¶å»¶è¿Ÿï¼‰

#### éŸ³é¢‘è®¾ç½®
- **éŸ³é¢‘æ¯”ç‰¹ç‡**ï¼š128-192 Kbps
- **é‡‡æ ·ç‡**ï¼š44.1 kHz æˆ– 48 kHz
- **å£°é“**ï¼šç«‹ä½“å£°

#### è§†é¢‘è®¾ç½®
- **åŸºç¡€åˆ†è¾¨ç‡**ï¼š1920x1080 æˆ–æ‚¨çš„å±å¹•åˆ†è¾¨ç‡
- **è¾“å‡ºåˆ†è¾¨ç‡**ï¼š1920x1080 æˆ– 1280x720
- **ä¸‹é‡‡æ ·è¿‡æ»¤å™¨**ï¼šLanczos
- **FPS**ï¼š30 æˆ– 60

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

ä¸»è¦é…ç½®é¡¹åœ¨ `config.py` ä¸­ï¼š

```python
# ç½‘ç»œé»˜è®¤é…ç½®
NETWORK_DEFAULTS = {
    "srt_input_port": 9001,      # SRTè¾“å…¥ç«¯å£
    "websocket_port": 10086,     # WebSocketç«¯å£
    "verification_code": "114514", # é»˜è®¤éªŒè¯ç 
    "enable_local_play": True,    # é»˜è®¤å¼€å¯æœ¬åœ°æ’­æ”¾
}

# MPVé‡è¯•é…ç½®
MPV_PARAMS = {
    "retry": {
        "sender_interval": 3,     # å‘é€ç«¯é‡è¯•é—´éš”ï¼ˆç§’ï¼‰
        "receiver_delay": 2       # æ¥æ”¶ç«¯å¯åŠ¨å»¶è¿Ÿï¼ˆç§’ï¼‰
    }
}
```

## ğŸ“Š æ—¥å¿—ç³»ç»Ÿ

### æ—¥å¿—æ–‡ä»¶ä½ç½®
- **ä¸»ç¨‹åºæ—¥å¿—**ï¼š`logs/online_theater.log`
- **FFmpegæ—¥å¿—**ï¼š`logs/ffmpeg/[è¿›ç¨‹å]_[æ—¶é—´æˆ³].log`

### æ—¥å¿—çº§åˆ«
- æ§åˆ¶å°ï¼šåªæ˜¾ç¤ºWARNINGåŠä»¥ä¸Šçº§åˆ«
- æ–‡ä»¶ï¼šè®°å½•æ‰€æœ‰è¯¦ç»†ä¿¡æ¯

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿æ¥å¤±è´¥
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ç›¸åº”ç«¯å£å·²å¼€æ”¾
- Windowsé˜²ç«å¢™ï¼šå…è®¸ç¨‹åºé€šè¿‡é˜²ç«å¢™
- è·¯ç”±å™¨ï¼šå¦‚éœ€å¤–ç½‘è®¿é—®ï¼Œé…ç½®ç«¯å£è½¬å‘

#### 2. OBSæ¨æµå¤±è´¥
- ç¡®è®¤SRTåœ°å€æ ¼å¼æ­£ç¡®ï¼š`srt://IP:ç«¯å£`
- æ£€æŸ¥å‘é€ç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹ `logs/ffmpeg/` ç›®å½•ä¸‹çš„æ—¥å¿—

#### 3. MPVæ— æ³•æ’­æ”¾
- å‘é€ç«¯ï¼šMPVä¼šæŒç»­å°è¯•è¿æ¥ï¼Œç­‰å¾…OBSæ¨æµ
- æ¥æ”¶ç«¯ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®è®¤æœåŠ¡å™¨åœ°å€æ­£ç¡®
- æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯

#### 4. ç¨‹åºæ— æ³•å¯åŠ¨
- ç¡®è®¤Pythonç‰ˆæœ¬ >= 3.8
- ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²å®‰è£…ï¼š`pip install -r requirements.txt`
- ç¡®è®¤å¤–éƒ¨ç¨‹åºï¼ˆffmpeg.exe, mpv.exe, nginx.exeï¼‰å­˜åœ¨

#### 5. éªŒè¯ç é”™è¯¯
- ç¡®è®¤è¾“å…¥çš„æ˜¯6ä½æ•°å­—
- æ£€æŸ¥æ˜¯å¦ä¸å‘é€ç«¯è®¾ç½®çš„éªŒè¯ç ä¸€è‡´

### ç«¯å£å ç”¨é—®é¢˜

å¦‚æœæç¤ºç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ï¼š
1. æ›´æ”¹é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤ç«¯å£
2. æˆ–ä½¿ç”¨å‘½ä»¤æŸ¥æ‰¾å ç”¨ç«¯å£çš„ç¨‹åºï¼š
   ```bash
   # Windows
   netstat -ano | findstr :9001
   
   # Linux/macOS
   lsof -i :9001
   ```

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **éªŒè¯ç **ï¼šä½¿ç”¨å¤æ‚çš„éªŒè¯ç ï¼Œé¿å…æœªæˆæƒè®¿é—®
2. **é˜²ç«å¢™**ï¼šä»…å¼€æ”¾å¿…è¦çš„ç«¯å£
3. **å±€åŸŸç½‘ä½¿ç”¨**ï¼šå»ºè®®åœ¨å¯ä¿¡ç½‘ç»œç¯å¢ƒä¸­ä½¿ç”¨
4. **å®šæœŸæ›´æ–°**ï¼šä¿æŒç¨‹åºå’Œä¾èµ–çš„æ›´æ–°

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
online_theater/
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â”œâ”€â”€ .gitignore            # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md             # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ start.bat             # Windowså¯åŠ¨è„šæœ¬
â”œâ”€â”€ ui/                   # ç”¨æˆ·ç•Œé¢æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main_window.py    # ä¸»çª—å£
â”‚   â”œâ”€â”€ sender_setup.py   # å‘é€ç«¯è®¾ç½®
â”‚   â”œâ”€â”€ receiver_setup.py # æ¥æ”¶ç«¯è®¾ç½®
â”‚   â””â”€â”€ chat_room.py      # èŠå¤©å®¤ç•Œé¢
â”œâ”€â”€ network/              # ç½‘ç»œæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ websocket_server.py # WebSocketæœåŠ¡å™¨
â”‚   â””â”€â”€ websocket_client.py # WebSocketå®¢æˆ·ç«¯
â”œâ”€â”€ streaming/            # æµåª’ä½“æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ffmpeg_manager.py # FFmpegç®¡ç†
â”‚   â”œâ”€â”€ mpv_player.py     # MPVæ’­æ”¾å™¨ç®¡ç†
â”‚   â””â”€â”€ nginx_manager.py  # Nginxç®¡ç†
â””â”€â”€ utils/                # å·¥å…·æ¨¡å—
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ logger.py         # æ—¥å¿—ç®¡ç†
    â”œâ”€â”€ network_utils.py  # ç½‘ç»œå·¥å…·
    â””â”€â”€ process_manager.py # è¿›ç¨‹ç®¡ç†
```

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.0.1 (2025-08-12)
- ğŸ¯ ä½¿ç”¨QTimerå®ç°å®¢æˆ·ç«¯MPVå»¶è¿Ÿå¯åŠ¨
- ğŸ”„ å‘é€ç«¯MPVæ— é™å¾ªç¯ç­‰å¾…OBSæ¨æµ
- ğŸ“ ä¼˜åŒ–æ—¥å¿—è¾“å‡ºï¼ŒFFmpegæ—¥å¿—åªå†™å…¥æ–‡ä»¶
- ğŸ› ä¿®å¤WebSocketå®¢æˆ·ç«¯å…³é—­æ—¶çš„å¼‚å¸¸
- ğŸ¨ ä¿®å¤èŠå¤©å®¤emojiæ˜¾ç¤ºå’Œæ¶ˆæ¯æ¢è¡Œé—®é¢˜
- ğŸ”§ æ·»åŠ æ›´å¤šé…ç½®é€‰é¡¹

### v1.0.0 (2025-08-12)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ æ”¯æŒSRT/RTMPæµè½¬å‘
- ğŸ’¬ WebSocketèŠå¤©å®¤
- ğŸŒ IPv6ä¼˜å…ˆæ”¯æŒ
- ğŸ‘¥ å¤šå®¢æˆ·ç«¯æ”¯æŒ

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ™ è‡´è°¢

- FFmpeg - å¼ºå¤§çš„å¤šåª’ä½“æ¡†æ¶
- MPV - ä¼˜ç§€çš„åª’ä½“æ’­æ”¾å™¨
- Nginx-RTMP - ç¨³å®šçš„æµåª’ä½“æœåŠ¡å™¨
- PySide6 - Qt for Python

## ğŸ“ è”ç³»æ–¹å¼

- GitHub Issues: [æäº¤é—®é¢˜](https://github.com/TamakiIroha3/Online-Theatre-With-Chat-Room/issues)
- Email: 478065832@qq.com

---

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œä¸ªäººä½¿ç”¨ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚
